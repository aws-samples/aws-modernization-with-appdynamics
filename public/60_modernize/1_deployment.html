<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.99.0" />
    <meta name="description" content="AppDynamics Workshop">
<meta name="author" content="James Schneider">

    <link rel="icon" href="https://appd-modernization.awsworkshop.io/images/favicon.png" type="image/x-icon" />

    <title>Deployment :: English</title>

    
    <link href="/css/nucleus.css?1676919882" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1676919882" rel="stylesheet">
    <link href="/css/hybrid.css?1676919882" rel="stylesheet">
    <link href="/css/featherlight.min.css?1676919882" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1676919882" rel="stylesheet">
    <link href="/css/auto-complete.css?1676919882" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1676919882" rel="stylesheet">
    <link href="/css/theme.css?1676919882" rel="stylesheet">
    <link href="/css/hugo-theme.css?1676919882" rel="stylesheet">
    
    <link href="/css/theme-mine.css?1676919882" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1676919882"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/60_modernize/1_deployment.html">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a href="/" title="Go home"><img style="vertical-align:middle;margin:30px;" src="../../images/AWS-Logo_White-Color.png" height="125px">

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1676919882"></script>
<script type="text/javascript" src="/js/auto-complete.js?1676919882"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1676919882"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/10_backstory.html" title="Backstory" class="dd-item
        
        
        
        ">
      <a href="/10_backstory.html">
          Backstory
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/20_getting_started.html" title="Getting Started" class="dd-item
        
        
        
        ">
      <a href="/20_getting_started.html">
          Getting Started
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/20_getting_started/1_aws_event_engine.html" title="AWS Event Engine" class="dd-item ">
        <a href="/20_getting_started/1_aws_event_engine.html">
        AWS Event Engine
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/20_getting_started/2_aws_account.html" title="AWS Account" class="dd-item ">
        <a href="/20_getting_started/2_aws_account.html">
        AWS Account
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/20_getting_started/3_appd_account.html" title="AppDynamics Account" class="dd-item ">
        <a href="/20_getting_started/3_appd_account.html">
        AppDynamics Account
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/20_getting_started/4_aws_credits.html" title="AWS Credit Request" class="dd-item ">
        <a href="/20_getting_started/4_aws_credits.html">
        AWS Credit Request
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/30_workshop_setup.html" title="Workshop Setup" class="dd-item
        
        
        
        ">
      <a href="/30_workshop_setup.html">
          Workshop Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/30_workshop_setup/1_create_cloud9.html" title="Create Cloud9 Workspace" class="dd-item ">
        <a href="/30_workshop_setup/1_create_cloud9.html">
        Create Cloud9 Workspace
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/30_workshop_setup/2_create_iam_role.html" title="Create IAM Role for Workspace" class="dd-item ">
        <a href="/30_workshop_setup/2_create_iam_role.html">
        Create IAM Role for Workspace
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/30_workshop_setup/3_attach_iam_role.html" title="Attach IAM Role to Workspace" class="dd-item ">
        <a href="/30_workshop_setup/3_attach_iam_role.html">
        Attach IAM Role to Workspace
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/30_workshop_setup/4_cloud9_update.html" title="Update Cloud9 Workspace" class="dd-item ">
        <a href="/30_workshop_setup/4_cloud9_update.html">
        Update Cloud9 Workspace
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/30_workshop_setup/5_start_engines.html" title="Start Your Engines ! " class="dd-item ">
        <a href="/30_workshop_setup/5_start_engines.html">
        Start Your Engines ! 
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/40_appdynamics_advantage.html" title="AppDynamics Advantage" class="dd-item
        
        
        
        ">
      <a href="/40_appdynamics_advantage.html">
          AppDynamics Advantage
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/50_mobilize.html" title="Mobilize" class="dd-item
        
        
        
        ">
      <a href="/50_mobilize.html">
          Mobilize
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/50_mobilize/1_review_app.html" title="AD Financial Web UI" class="dd-item ">
        <a href="/50_mobilize/1_review_app.html">
        AD Financial Web UI
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/50_mobilize/2_login_appd.html" title="Login to AppDynamics" class="dd-item ">
        <a href="/50_mobilize/2_login_appd.html">
        Login to AppDynamics
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/50_mobilize/3_browser_rum.html" title="End User Monitoring" class="dd-item ">
        <a href="/50_mobilize/3_browser_rum.html">
        End User Monitoring
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/50_mobilize/4_flowmaps.html" title="Flow Maps" class="dd-item ">
        <a href="/50_mobilize/4_flowmaps.html">
        Flow Maps
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/50_mobilize/5_business_txns.html" title="Business Transactions" class="dd-item ">
        <a href="/50_mobilize/5_business_txns.html">
        Business Transactions
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/50_mobilize/6_databases.html" title="Databases" class="dd-item ">
        <a href="/50_mobilize/6_databases.html">
        Databases
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/50_mobilize/7_summary.html" title="Summary" class="dd-item ">
        <a href="/50_mobilize/7_summary.html">
        Summary
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/60_modernize.html" title="Modernize" class="dd-item
        parent
        
        
        ">
      <a href="/60_modernize.html">
          Modernize
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/60_modernize/1_deployment.html" title="Deployment" class="dd-item active">
        <a href="/60_modernize/1_deployment.html">
        Deployment
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/60_modernize/2_accelerate.html" title="Accelerate" class="dd-item ">
        <a href="/60_modernize/2_accelerate.html">
        Accelerate
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/60_modernize/3_scale.html" title="Scale" class="dd-item ">
        <a href="/60_modernize/3_scale.html">
        Scale
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/60_modernize/4_business_iq.html" title="Business iQ" class="dd-item ">
        <a href="/60_modernize/4_business_iq.html">
        Business iQ
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/60_modernize/5_summary.html" title="Summary" class="dd-item ">
        <a href="/60_modernize/5_summary.html">
        Summary
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/70_operate.html" title="Operate" class="dd-item
        
        
        
        ">
      <a href="/70_operate.html">
          Operate
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/70_operate/1_deployment.html" title="Deployment" class="dd-item ">
        <a href="/70_operate/1_deployment.html">
        Deployment
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/70_operate/2_cognition_engine.html" title="Cognition Engine" class="dd-item ">
        <a href="/70_operate/2_cognition_engine.html">
        Cognition Engine
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/70_operate/3_cluster_agent.html" title="Cluster Agent" class="dd-item ">
        <a href="/70_operate/3_cluster_agent.html">
        Cluster Agent
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/80_wrapup.html" title="Wrapup" class="dd-item
        
        
        
        ">
      <a href="/80_wrapup.html">
          Wrapup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/80_wrapup/1_workshop_teardown.html" title="Workshop Cleanup" class="dd-item ">
        <a href="/80_wrapup/1_workshop_teardown.html">
        Workshop Cleanup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/80_wrapup/2_cloud9_cleanup.html" title="Cloud9 Cleanup" class="dd-item ">
        <a href="/80_wrapup/2_cloud9_cleanup.html">
        Cloud9 Cleanup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/80_wrapup/3_survey.html" title="Survey" class="dd-item ">
        <a href="/80_wrapup/3_survey.html">
        Survey
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://www.appdynamics.com/product/infrastructure-monitoring/cloud-monitoring"><i class='fas fa-chalkboard-teacher'></i> AppDynamics Advantage</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.appdynamics.com/resources/ebook/how-to-monitor-kubernetes-with-confidence"><i class='fas fa-chalkboard-teacher'></i> Monitor Kubentes with Confidence</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.appdynamics.com/c/dam/r/appdynamics/general-documents/use-cases/biq-use-case-guide-2020.pdf"><i class='fas fa-chalkboard-teacher'></i> 6 Business iQ Use Cases</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.appdynamics.com/solutions/cloud/cloud-monitoring/kubernetes-monitoring/how-to-monitor-kubernetes-best-practices"><i class='fas fa-chalkboard-teacher'></i> K8s Monitoring Best Practices</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.appdynamics.com/blog/product/scaling-kubernetes-observability/"><i class='fas fa-chalkboard-teacher'></i> Scaling Kubernetes with AppD</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      

      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>

    <a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a
        href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | <a
        href="https://modernization-workshop-bucket.s3-us-west-2.amazonaws.com/license/cc-license.html">CC BY-SA 4.0</a>

</left>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Advanced Observability with AppDynamics</a> > <a href='/60_modernize.html'>Modernize</a> > Deployment
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#create-the-eks-cluster">Create the EKS Cluster</a></li>
<li><a href="#deploy-the-application-to-eks">Deploy the Application to EKS</a></li>
<li><a href="#deploy-the-server-agent-to-eks">Deploy the Server Agent to EKS</a></li>
<li><a href="#database-visibility-agent">Database Visibility Agent</a></li>
<li><a href="#next-i-class-fas-fa-cog-fa-spin-i">Next <i class='fas fa-cog fa-spin'></i></a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Deployment
            </h1>
          

        




<p><img src="/images/modernize/ad_team_developer.png" alt="image" /></p>

<p>In this section you&rsquo;ll be performing the following setup and deployment steps:
 - Create a two node EKS cluster
 - Deploy the application to EKS
 - Deploy the server agent to EKS</p>

<h2 id="create-the-eks-cluster">Create the EKS Cluster</h2>

<p>Let&rsquo;s start by looking at the script that creates the EKS cluster using the commands below in your Cloud9 terminal:</p>
<pre tabindex="0"><code>cd /opt/appdynamics/workshopuser

cat -n deployEksCluster.sh</code></pre>
<p>The script calls <a href="https://eksctl.io" target="_blank"><strong>eksctl</strong></a> passing the <strong>cluster.yaml</strong> file to provide the cluster definition.</p>

<p>Take a quick look at the <strong>cluster.yaml</strong> file using the commands below:</p>
<pre tabindex="0"><code>cd /opt/appdynamics/workshopuser/post-mod-kube-cluster

cat -n cluster.yaml</code></pre>
<p>Notice where we&rsquo;ve defined the name of the cluster, the region and availability zones to deploy to, the instance type for the nodes. and the number of nodes.</p>


<div class="notices info" ><p>Notice that the <strong>default availability zones defined</strong> in the <strong>cluster.yaml file</strong> are <strong>a</strong> and <strong>c</strong> on line number 9 in the image below.  It is advisable to run the command below to check that both of those availability zones are supported in your region.  You can <strong>use the command below</strong> to check the <strong>supported availability zones in your region</strong>. You can read more information about checking availability zones <a href="https://aws.amazon.com/premiumsupport/knowledge-center/vpc-find-availability-zone-options/" target="_blank"><strong>here</strong></a>.  You <strong>may need to edit</strong> the <strong>cluster.yaml</strong> file to change the availability zones to the ones supported in your region before your create the EKS cluster.</p>
</div>


<p>Example command to check for supported availability zones if your region is <strong>us-east-2</strong></p>
<pre tabindex="0"><code>aws ec2 describe-availability-zones --region us-east-2</code></pre>
<p><img src="/images/modernize/kube-conf-01.png" alt="image" /></p>


<div class="notices warning" ><p>You must <strong>have enough available VPCs, Elastic IPs, and NAT Gateways in the region you are working in</strong> to successfully <strong>create an EKS Cluster</strong> with a managed node group of 2 nodes.  If you <strong>run into a problem</strong> during the setup, it is <strong>usually associated with insufficient resources or permissions in your AWS account</strong>.  You can resolve resource constraints by <a href="https://docs.aws.amazon.com/servicequotas/latest/userguide/request-quota-increase.html" target="_blank"><strong>requesting a quota increase</strong></a> for your AWS account.</p>
</div>


<p>Go ahead and create the EKS cluster using the commands below:
 - cluster creation takes ~16 minutes to finish so please be patient and let the process complete</p>
<pre tabindex="0"><code>cd /opt/appdynamics/workshopuser

./deployEksCluster.sh</code></pre>
<p>The image below shows what the output looks like for the EKS cluster creation.</p>

<p><img src="/images/modernize/kube-deploy-01.png" alt="image" /></p>

<p><br></p>

<h2 id="deploy-the-application-to-eks">Deploy the Application to EKS</h2>

<p>Now that the EKS cluster is up and running, use the commands below to deploy the modernized application to EKS:
 - deployment and initialization takes ~4 minutes to finish</p>
<pre tabindex="0"><code>cd /opt/appdynamics/workshopuser

./deployEksApplication.sh</code></pre>
<p>The image below shows what the output looks like for the application deployment and initialization.</p>

<p><img src="/images/modernize/kube-deploy-02.png" alt="image" /></p>

<p>Let&rsquo;s take a look at how the application and the Java APM agent were configured for EKS deployment.  We&rsquo;ve used the <strong>config-map.yaml</strong> file to define the properties needed by the agent to connect to the controller.  The setup script you executed in the workshop setup section, auto-populated the agent to controller configuration properties for you just like the <strong>application.env</strong> file used for the Docker Compose application.  You can read more about the Agent to Controller Connection properties <a href="https://docs.appdynamics.com/latest/en/application-monitoring/install-app-server-agents/agent-to-controller-connections" target="_blank"><strong>here</strong></a></p>

<p>Take a look at the <strong>config-map.yaml</strong> file using the commands below:</p>
<pre tabindex="0"><code>cd /opt/appdynamics/workshopuser/post-mod-kube-app

cat -n config-map.yaml</code></pre>
<p>Notice that we&rsquo;ve defined the Tier and Node names here in one place instead of each service deployment file.  Next we&rsquo;ll take a look at how we reference those within the <strong>account-management.yaml</strong> file used to deploy the AccountManagement service along with the way we configured the Java APM agent.</p>

<p><img src="/images/modernize/kube-conf-02.png" alt="image" /></p>

<p>Use the commands below to examine the <strong>account-management.yaml</strong> file:</p>
<pre tabindex="0"><code>cd /opt/appdynamics/workshopuser/post-mod-kube-app

cat -n account-management.yaml</code></pre>
<p>In the section of the file seen below, we are defining the Java Agent in an <strong>initContainer</strong> and referencing a pre-built Docker image of the Java Agent.</p>

<p><strong>Where do we</strong> reference the Docker image of the Java Agent <strong>?</strong>
 - on <strong>line 18</strong> we are providing the reference to the pre-built public image that can be found <a href="https://hub.docker.com/r/appdynamics/java-agent/tags?page=1&ordering=last_updated" target="_blank"><strong>here</strong></a></p>

<p><strong>How do we</strong> expose the directory on the image where the Java Agent binaries can be accessed by the application container that references it <strong>?</strong>
 - on <strong>lines 21 - 22</strong> we are specifying the details for the volume mount</p>

<p><img src="/images/modernize/kube-conf-03.png" alt="image" /></p>

<p>Starting on <strong>line 26</strong> we see the first part of the <strong>definition for the *&ldquo;account-management&rdquo;</strong>* application container.</p>

<p><strong>Notice</strong> that the account-management container has its own image defined containing just the application code (e.g. <strong>line 28</strong>).</p>

<p><strong>How does the</strong> Java Agent obtain its connection properties to the controller <strong>?</strong>
 - on <strong>line 29 - 31</strong>, we&rsquo;re pulling in the reference to the &ldquo;config-map.yaml&rdquo; file that contains those as well as the APM application name</p>

<p><strong>How does the</strong> Java Agent get bootstrapped into the application JVM startup <strong>?</strong>
 - on <strong>line 36</strong>, we&rsquo;re telling Kubernetes to add the Java Agent bootstrap parameter to the JVM startup</p>

<p><img src="/images/modernize/kube-conf-04.png" alt="image" /></p>

<p><strong>How does the</strong> <em>account-management</em> container get its Tier and Node name assigned <strong>?</strong>
 - on <strong>line 45 - 49</strong>, we are assigning the <strong>Tier name</strong> by pulling in a specific variable from the &ldquo;config-map.yaml&rdquo;
 - on <strong>line 54 - 58</strong>, we are assigning the <strong>Node name</strong> by pulling in a specific variable from the &ldquo;config-map.yaml&rdquo;
 - on <strong>line 51 - 52</strong>, we are telling the Java Agent to reuse the Node names when containers are recycled</p>

<p><strong>How do we</strong> load the binaries for the Java Agent into the application container <strong>?</strong>
 - on <strong>line 64 - 66</strong>, we are pulling in the shared volume/directory from the Java Agent Init Container</p>

<p><img src="/images/modernize/kube-conf-05.png" alt="image" /></p>

<p>You can read more about using the Java Agent with Init Containers <a href="https://docs.appdynamics.com/latest/en/application-monitoring/install-app-server-agents/java-agent/install-the-java-agent/install-the-java-agent-in-containers#InstalltheJavaAgentinContainers-init" target="_blank"><strong>here</strong></a></p>

<p>You can read more about building the Java Agent into your own Docker Image <a href="https://docs.appdynamics.com/latest/en/application-monitoring/install-app-server-agents/java-agent/install-the-java-agent/install-the-java-agent-in-containers#InstalltheJavaAgentinContainers-dockerfile" target="_blank"><strong>here</strong></a></p>

<p><br></p>

<h2 id="deploy-the-server-agent-to-eks">Deploy the Server Agent to EKS</h2>

<p>The final deployment step in this section will be deploying the Server Agent to the EKS cluster using the commands below:</p>
<pre tabindex="0"><code>cd /opt/appdynamics/workshopuser

./deployMachineAgent.sh</code></pre>
<p>The image below shows what the output looks like for the Server Agent deployment.</p>

<p><img src="/images/modernize/kube-deploy-03.png" alt="image" /></p>

<p>The Server Visibility Agent when deployed to Kubernetes <strong>differs</strong> from the Java Agent in that:</p>

<ul>
<li>the Server Visibility Agent should be deployed as a DaemonSet</li>
<li>it runs in its own container within its own JVM on each node in the cluster</li>
<li>the Server Visibility Agent does not require the definition of an application, tier, or node name, since it scans the process list/containers on the node to find AppDynamics APM agents in use and relates itself to those processes/containers</li>
</ul>

<p>The Server Visibility Agent when deployed to Kubernetes <strong>is similar to</strong> the Java Agent in that:
- it will use the same controller connection properties defined in the <em>config-map.yaml</em> file
- we are using a pre-built Docker image of the agent for this workshop
- you have the option of building your own Docker image of the agent in your own repository</p>

<p>Use the commands below to view the <strong>machine-agent.yaml</strong> file used to deploy the agent:</p>
<pre tabindex="0"><code>cd /opt/appdynamics/workshopuser/post-mod-kube-ma

cat -n machine-agent.yaml</code></pre>
<p>Scroll down the file until you get to <strong>line 16</strong>.  Here we see the container <strong>definition for the *&ldquo;appd-infra-agent&rdquo;</strong>* AKA the Server Visibility Agent.</p>

<p>We are defining the Server Visibility Agent container and referencing a pre-built Docker image for it on <strong>line 17</strong> that can be found <a href="https://hub.docker.com/r/appdynamics/machine-agent-analytics/tags?page=1&ordering=last_updated" target="_blank"><strong>here</strong></a></p>

<p><strong>How does the</strong> Server Visibility Agent obtain its connection properties to the controller <strong>?</strong>
 - on <strong>line 26 - 28</strong>, we&rsquo;re pulling in the &ldquo;config-map.yaml&rdquo; file that contains those properties</p>

<p><strong>What additional</strong> properties are needed for the agent <strong>?</strong>
- the property on <strong>line 20</strong> is required if you want to collect more than minimal host level metrics
- it is highly recommended to replicate <strong>lines 22 - 24</strong> as well if using an older agent version</p>

<p><img src="/images/modernize/kube-conf-06.png" alt="image" /></p>

<p>You can read more about building the Server Visibility Agent into your own Docker Container Image <a href="https://github.com/Appdynamics/appdynamics-docker-images/tree/master/appd-machine-agent-analytics" target="_blank"><strong>here</strong></a></p>

<p><br></p>

<h2 id="database-visibility-agent">Database Visibility Agent</h2>

<p>The AppDynamics Database Agent is a standalone Java program that collects performance metrics about your database instances and database servers. You can deploy the Database Agent on any machine running Java 1.8 or higher. The machine must have network access to the AppDynamics Controller and the database instance that you want to be monitored.</p>

<p>A single database agent can monitor multiple databases at once by using multiple database collector configurations.  The workshop setup utility installed the agent on your Cloud9 instance and also created two database collector configurations inside the controller.  You can see the running agent process by using the command below:</p>
<pre tabindex="0"><code>ps -ef | grep db-agent</code></pre>
<p>In the case of the database agent, JVM command line properties were used to connect the agent to the controller.  Take notice of the &ldquo;-Ddbagent.name&rdquo; property.  This property is used to link a specific database agent to a database collector configuration.  Most of these properties could have optionally been defined in the agents configuration file, which can be seen by using the commands below:</p>
<pre tabindex="0"><code>cd /opt/appdynamics/dbagent/conf

cat controller-info.xml</code></pre>
<p>The image below shows an example of the database collector configuration to monitor the MySQL database used in the post-modernized EKS application.</p>

<p>Once the database agent is running with a specific name, its name should appear in the drop-down of available agents so you can associate it with the collector you&rsquo;re creating.  Since this is an RDS database, we have used the RDS endpoint as the hostname.  We can use the port &ldquo;3306&rdquo; for the DB since we have exposed it specifically in the VPC Security Group for the database.</p>

<p>You can see that we have used the &ldquo;root&rdquo; username and password to connect to the database and monitor it.  The recommended practice is to create a specific database user in the database and apply specific permissions to it for monitoring purposes.</p>

<p>You can read more about deploying the database agent and configuring collectors <a href="https://docs.appdynamics.com/latest/en/database-visibility/administer-the-database-agent" target="_blank"><strong>here</strong></a> and <a href="https://docs.appdynamics.com/latest/en/database-visibility/add-database-collectors" target="_blank"><strong>here</strong></a></p>

<p><img src="/images/modernize/kube-conf-07.png" alt="image" /></p>

<p><br></p>

<h2 id="next-i-class-fas-fa-cog-fa-spin-i">Next <i class='fas fa-cog fa-spin'></i></h2>

<p>Letâ€™s follow Alex and his team as they <strong>utilize AppDynamics, having purpose built integrations for AWS</strong> that <strong>provides application performance monitoring continuity</strong> throughout the <strong>entire application modernization architecture lifecycle</strong>.</p>

<!---

<div class="notices warning" ><p>The Cloud9 workspace should be built by an IAM user with Administrator privileges,
not the root account user. Please ensure you are logged in as an IAM user, not the root
account user.</p>
</div>

-->

<!---

<div class="notices info" ><p>This workshop was designed to run in the <strong>Oregon (us-west-2)</strong> region. <strong>Please don&rsquo;t
run in any other region.</strong> Future versions of this workshop will expand region availability,
and this message will be removed.</p>
</div>

-->

<!---

<div class="notices tip" ><p>Ad blockers, javascript disablers, and tracking blockers should be disabled for
the cloud9 domain, or connecting to the workspace might be impacted.
Cloud9 requires third-party-cookies. You can whitelist the <a href="https://docs.aws.amazon.com/cloud9/latest/user-guide/troubleshooting.html#troubleshooting-env-loading" target="_blank">specific domains</a>.</p>
</div>

-->


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/60_modernize.html" title="Modernize"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/60_modernize/2_accelerate.html" title="Accelerate" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1676919882"></script>
    <script src="/js/perfect-scrollbar.min.js?1676919882"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1676919882"></script>
    <script src="/js/jquery.sticky.js?1676919882"></script>
    <script src="/js/featherlight.min.js?1676919882"></script>
    <script src="/js/highlight.pack.js?1676919882"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1676919882"></script>
    <script src="/js/learn.js?1676919882"></script>
    <script src="/js/hugo-learn.js?1676919882"></script>
    
        
            <script src="/mermaid/mermaid.js?1676919882"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

